<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sig (sihl.Sihl__Contract_user.Sig)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">sihl</a> &#x00BB; <a href="../index.html">Sihl__Contract_user</a> &#x00BB; Sig</nav><h1>Module type <code>Sihl__Contract_user.Sig</code></h1></header><div class="spec module" id="module-Web"><a href="#module-Web" class="anchor"></a><code><span class="keyword">module</span> <a href="Web/index.html">Web</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-search"><a href="#val-search" class="anchor"></a><code><span class="keyword">val</span> search : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;sort:<span>[ `Desc <span>| `Asc</span> ]</span></span> <span>&#45;&gt;</span> <span>?&#8288;filter:string</span> <span>&#45;&gt;</span> <span>?&#8288;limit:int</span> <span>&#45;&gt;</span> <span>?&#8288;offset:int</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span>(<span><a href="../index.html#type-t">t</a> list</span> * int)</span> Lwt.t</span></code></dt><dd><p><code>search ?ctx ?sort ?filter ?limit ?offset ()</code> returns a list of users that is a partial view on all stored users.</p><p><code>sort</code> is the default sorting order of the created date. By default, this value is <code>`Desc</code>.</p><p><code>filter</code> is a search keyword that is applied in a best-effort way on user details. The keyword has to occur in only one field (such as email).</p><p><code>limit</code> is the length of the returned list.</p><p><code>offset</code> is the pagination offset of the partial view.</p></dd></dl><dl><dt class="spec value" id="val-find_opt"><a href="#val-find_opt" class="anchor"></a><code><span class="keyword">val</span> find_opt : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="../index.html#type-t">t</a> option</span> Lwt.t</span></code></dt><dd><p><code>find_opt ?ctx id</code> returns a user with <code>id</code>.</p></dd></dl><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="../index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>find ?ctx id</code> returns a user with <code>id</code>, <code>None</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-find_by_email"><a href="#val-find_by_email" class="anchor"></a><code><span class="keyword">val</span> find_by_email : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="../index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>find_by_email ?ctx email</code> returns a <code>User.t</code> if there is a user with email address <code>email</code>. The lookup is case-insensitive. Raises an <code>{!Exception}</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-find_by_email_opt"><a href="#val-find_by_email_opt" class="anchor"></a><code><span class="keyword">val</span> find_by_email_opt : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="../index.html#type-t">t</a> option</span> Lwt.t</span></code></dt><dd><p><code>find_by_email_opt ?ctx email</code> returns a <code>User.t</code> if there is a user with email address <code>email</code>.</p></dd></dl><dl><dt class="spec value" id="val-update_password"><a href="#val-update_password" class="anchor"></a><code><span class="keyword">val</span> update_password : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;password_policy:<span>(string <span>&#45;&gt;</span> <span><span>(unit, string)</span> Result.t</span>)</span></span> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span>old_password:string</span> <span>&#45;&gt;</span> <span>new_password:string</span> <span>&#45;&gt;</span> <span>new_password_confirmation:string</span> <span>&#45;&gt;</span> <span><span><span>(<a href="../index.html#type-t">t</a>, string)</span> Result.t</span> Lwt.t</span></code></dt><dd><p><code>update_password ?ctx ?password_policy user ~old_password ~new_password
      ~new_password_confirmation</code> updates the password of a <code>user</code> to <code>new_password</code> and returns the user. The <code>old_password</code> is the current password that the user has to enter. <code>new_password</code> has to equal <code>new_password_confirmation</code>.</p><p><code>password_policy</code> is a function that validates the <code>new_password</code> based on some password policy. By default, the policy is that a password has to be at least 8 characters long.</p></dd></dl><dl><dt class="spec value" id="val-update"><a href="#val-update" class="anchor"></a><code><span class="keyword">val</span> update : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;email:string</span> <span>&#45;&gt;</span> <span>?&#8288;username:string</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;given_name:string</span> <span>&#45;&gt;</span> <span>?&#8288;status:<a href="../index.html#type-status">status</a></span> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>update ?ctx?email ?username ?name ?given_name ?status user</code> stores the updated <code>user</code> and returns it.</p></dd></dl><dl><dt class="spec value" id="val-update_details"><a href="#val-update_details" class="anchor"></a><code><span class="keyword">val</span> update_details : <span>user:<a href="../index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>email:string</span> <span>&#45;&gt;</span> <span>username:<span>string option</span></span> <span>&#45;&gt;</span> <span><a href="../index.html#type-t">t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-set_password"><a href="#val-set_password" class="anchor"></a><code><span class="keyword">val</span> set_password : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;password_policy:<span>(string <span>&#45;&gt;</span> <span><span>(unit, string)</span> Result.t</span>)</span></span> <span>&#45;&gt;</span> <a href="../index.html#type-t">t</a> <span>&#45;&gt;</span> <span>password:string</span> <span>&#45;&gt;</span> <span>password_confirmation:string</span> <span>&#45;&gt;</span> <span><span><span>(<a href="../index.html#type-t">t</a>, string)</span> Result.t</span> Lwt.t</span></code></dt><dd><p><code>set_password ?ctx ?policy user ~password ~password_confirmation</code> overrides the current password of a <code>user</code> and returns that user. <code>password</code> has to equal <code>password_confirmation</code>.</p><p><code>password_policy</code> is a function that validates the <code>new_password</code> based on some password policy. By default, the policy is that a password has to be at least 8 characters long.</p><p>The current password doesn't have to be provided, therefore you should not expose this function to users but only admins. If you want the user to update their own password use <a href="index.html#val-update_password"><code>update_password</code></a> instead.</p></dd></dl><dl><dt class="spec value" id="val-create_user"><a href="#val-create_user" class="anchor"></a><code><span class="keyword">val</span> create_user : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;username:string</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;given_name:string</span> <span>&#45;&gt;</span> <span>password:string</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="../index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>create_user ?ctx ?username ?name ?given_name email password</code> returns a non-admin user. Note that using <code>create_user</code> skips the registration workflow and should only be used with care.</p></dd></dl><dl><dt class="spec value" id="val-create_admin"><a href="#val-create_admin" class="anchor"></a><code><span class="keyword">val</span> create_admin : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;username:string</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;given_name:string</span> <span>&#45;&gt;</span> <span>password:string</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="../index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>create_admin ?ctx ?username ?name ?given_name email password</code> returns an admin user.</p></dd></dl><dl><dt class="spec value" id="val-register_user"><a href="#val-register_user" class="anchor"></a><code><span class="keyword">val</span> register_user : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;password_policy:<span>(string <span>&#45;&gt;</span> <span><span>(unit, string)</span> Stdlib.result</span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;username:string</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;given_name:string</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>password:string</span> <span>&#45;&gt;</span> <span>password_confirmation:string</span> <span>&#45;&gt;</span> <span><span><span>(<a href="../index.html#type-t">t</a>, <span>[ `Already_registered <span><span>| `Invalid_password_provided</span> of string</span> ]</span>)</span> Result.t</span> Lwt.t</span></code></dt><dd><p><code>register_user ?ctx ?password_policy ?username ?name ?given_name email password
      password_confirmation</code> creates a new user if the password is valid and if the email address was not already registered.</p><p>Provide <code>password_policy</code> to check whether the password fulfills certain criteria.</p></dd></dl><dl><dt class="spec value" id="val-login"><a href="#val-login" class="anchor"></a><code><span class="keyword">val</span> login : <span>?&#8288;ctx:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>password:string</span> <span>&#45;&gt;</span> <span><span><span>(<a href="../index.html#type-t">t</a>, <span>[ `Does_not_exist <span>| `Incorrect_password</span> ]</span>)</span> Result.t</span> Lwt.t</span></code></dt><dd><p><code>login ?ctx email ~password</code> returns the user associated with <code>email</code> if <code>password</code> matches the current password.</p></dd></dl><dl><dt class="spec value" id="val-register"><a href="#val-register" class="anchor"></a><code><span class="keyword">val</span> register : unit <span>&#45;&gt;</span> <a href="../../Sihl__/Core_service/index.html#type-t">Sihl__.Core_container.Service.t</a></code></dt></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../Sihl__/Core_service/index.html#module-type-Sig">Sihl__.Core_container.Service.Sig</a></code></span></summary><dl><dt class="spec value" id="val-lifecycle"><a href="#val-lifecycle" class="anchor"></a><code><span class="keyword">val</span> lifecycle : <a href="../../Sihl__/Core_lifecycle/index.html#type-lifecycle">Sihl__.Core_lifecycle.lifecycle</a></code></dt></dl></details></div></div></div></div></body></html>