<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (sihl-email.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ sihl-email</nav><h1 id="sihl-email"><a href="#sihl-email" class="anchor"></a>Sihl Email</h1><p>This module provides the email service and the email template service.</p><nav class="toc"><ul><li><a href="#email-service">Email service</a><ul><li><a href="#installation">Installation</a><ul><li><a href="#backend">Backend</a></li><li><a href="#registration">Registration</a></li></ul></li><li><a href="#configuration">Configuration</a></li><li><a href="#usage">Usage</a></li></ul></li><li><a href="#template-service">Template service</a><ul><li><a href="#installation">Installation</a><ul><li><a href="#backend">Backend</a></li><li><a href="#registration">Registration</a></li><li><a href="#migrations">Migrations</a></li></ul></li><li><a href="#usage">Usage</a></li></ul></li></ul></nav></header><h2 id="email-service"><a href="#email-service" class="anchor"></a>Email service</h2><p>The email service provides API for sending emails. Currently SMTP and <a href="https://sendgrid.com/">Sendgrid</a> are supported.</p><h3 id="installation"><a href="#installation" class="anchor"></a>Installation</h3><h4 id="backend"><a href="#backend" class="anchor"></a>Backend</h4><p>First, choose a backend in <code>service/service.ml</code>:</p><pre><code class="ml">module Email = Sihl_email.Smtp</code></pre><p>If you want to use the same backend multiple times with different configs, you can use the <code>Make</code> functors. The functor argument has to have a <code>fetch</code> function that takes a unit and returns the configuration for the backend wrapped in <code>Lwt.t</code>. This allows reading the config from IO.</p><pre><code class="ml">module MarketingSmtpConfig = struct
  let fetch () = Lwt.return {sender=&quot;marketing@mail.io&quot;; username=...}
end

module CustomerServiceSmtpConfig = struct
  let fetch () = Lwt.return {sender=&quot;help@mail.io&quot;; username=...}
  ...
end

module MarketingMail = Sihl_email.MakeSmtp (MarketingSmtpConfig)
module CustomerServiceMail = Sihl_email.MakeSmtp (CustomerServiceSmtpConfig)</code></pre><h4 id="registration"><a href="#registration" class="anchor"></a>Registration</h4><p>Then, register the service in <code>run/run.ml</code>:</p><pre><code class="ml">let services = [ Service.Email.register () ]</code></pre><h3 id="configuration"><a href="#configuration" class="anchor"></a>Configuration</h3><p>Run <code>make sihl config</code> to get a list of required configurations.</p><p>You can use <code>EMAIL_BYPASS_INTERCEPT</code> to actually use a configured SMTP server in a development setting (without having to set SIHl_ENV to production).</p><h3 id="usage"><a href="#usage" class="anchor"></a>Usage</h3><p>The API is documented in <a href="../sihl/Sihl__/Contract_email/module-type-Sig/index.html"><code>Sihl.Contract.Email.Sig</code></a>.</p><h2 id="template-service"><a href="#template-service" class="anchor"></a>Template service</h2><p>The template service can be used to create and edit email templates. Email templates are rendered with parameters to emails, that can be sent with the <code>email service</code>. Currently MariaDb (<span class="xref-unresolved" title="unresolved reference to &quot;Sihl_cache.MariaDb&quot;"><code>Sihl_cache</code>.MariaDb</span>) and PostgreSql (<span class="xref-unresolved" title="unresolved reference to &quot;Sihl_cache.PostgreSql&quot;"><code>Sihl_cache</code>.PostgreSql</span>) are supported.</p><h3 id="installation"><a href="#installation" class="anchor"></a>Installation</h3><h4 id="backend"><a href="#backend" class="anchor"></a>Backend</h4><p>First, choose a backend in <code>service/service.ml</code>:</p><pre><code class="ml">module Email_template = Sihl_email.Temlate.PostgreSql</code></pre><h4 id="registration"><a href="#registration" class="anchor"></a>Registration</h4><p>Then, register the service in <code>run/run.ml</code>:</p><pre><code class="ml">let services = [ Service.Email_template.register () ]</code></pre><h4 id="migrations"><a href="#migrations" class="anchor"></a>Migrations</h4><p>Run <code>make sihl migrate</code> to run pending migrations.</p><h3 id="usage"><a href="#usage" class="anchor"></a>Usage</h3><p>The API is documented in <a href="../sihl/Sihl__/Contract_email_template/module-type-Sig/index.html"><code>Sihl.Contract.Email_template.Sig</code></a>.</p></div></body></html>