<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (sihl-cache.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ sihl-cache</nav><h1 id="sihl-cache"><a href="#sihl-cache" class="anchor"></a>Sihl Cache</h1><p>This module provides the cache service and helpers to store arbitrary values. Think of the cache service as a generic key-value store where you can choose a backend.</p><p>Currently MariaDb (<a href="Sihl_cache/MariaDb/index.html"><code>Sihl_cache.MariaDb</code></a>) and PostgreSql (<a href="Sihl_cache/PostgreSql/index.html"><code>Sihl_cache.PostgreSql</code></a>) are supported.</p><nav class="toc"><ul><li><a href="#installation">Installation</a><ul><li><a href="#backend">Backend</a></li><li><a href="#registration">Registration</a></li><li><a href="#migrations">Migrations</a></li></ul></li><li><a href="#usage">Usage</a></li></ul></nav></header><h2 id="installation"><a href="#installation" class="anchor"></a>Installation</h2><h3 id="backend"><a href="#backend" class="anchor"></a>Backend</h3><p>First, choose a backend in <code>service/service.ml</code>:</p><pre><code class="ml">module Cache = Sihl_cache.PostgreSql</code></pre><h3 id="registration"><a href="#registration" class="anchor"></a>Registration</h3><p>Then, register the service in <code>run/run.ml</code>:</p><pre><code class="ml">let services = [ Service.Cache.register () ]</code></pre><h3 id="migrations"><a href="#migrations" class="anchor"></a>Migrations</h3><p>Run pending migrations with <code>make sihl migrate</code>.</p><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>The API is documented in <a href="../sihl/Sihl__/Contract_cache/module-type-Sig/index.html"><code>Sihl.Contract.Cache.Sig</code></a>.</p><pre><code class="ml">(* Associated user_id with a value *)
let%lwt () = Service.Cache.set (&quot;user_id&quot;, Some &quot;56&quot;) in
let%lwt user_id = Service.Cache.find &quot;user_id&quot; in
let () =
  match user_id with
  | Some user_id -&gt; print_endline @@ &quot;Found user &quot; ^ user_id
  | None -&gt; print_endline &quot;No user found&quot;
(* Delete user_id *)
Service.Cache.set (&quot;user_id&quot;, None)</code></pre></div></body></html>